# WebRTC Concept

> Web Real-Time Communication

- 웹 애플리케이션과 사이트가 중간자 없이 브라우저 간에 오디오나 영상 미디어를 포착하고 마음대로 스트림 할 뿐 아니라, 임의의 데이터도 교환할 수 있도록 하는 기술
- 드라이버나 플러그인 설치 없이 웹 브라우저 간 P2P 연결을 통해서 데이터 교환을 가능하게 하는 기술



## 절차



### P2P 절차

1. 각 브라우저가 P2P 커뮤니케이션에 동의
2. 서로의 주소를 공유
3. 보안 사항 및 방화벽 우회
4. 멀티미디어 데이터를 실시간으로 교환



### STUN, TURN

- 우리는 방화벽을 우회해서 P2P 를 해야한다.
  그 과정을 NAT 트래버셜 이라고 하며, 그 작업은 STUN 서버로 이루어진다.



####  STUN

> Session Traversal Utilities for NAT

- 단말이 자신의 공인 IP 주소와 포트를 확인하는 과정에 대한 프로토콜
- 자기자신을 식별할 수 있는 정보를 반환한다.
- STUN 으로 항상 자신의 정보를 알아낼 수는 없다.
  그것에 대한 대안으로 TURN 을 사용한다.



#### TURN

> Traversal Using Relay NAT

- 네트워크 미디어를 중개하는 서버를 이용하는 것
- 중간에 서버를 하나 거치는 것이라서 P2P 통신이 아니게 되며, 지연이 필연적으로 발생한다.



### ICE, Candidate



#### Candidate

> 후보

- STUN, TURN 서버를 이용해서 획득했던 IP 주소와 프로토콜, 포트의 조합으로 구성된 연결 가능한 네트워크 주소들
- 얻을 수 있는 주소들
  1. 자신의 사설 IP와 포트 넘버
  2. 자신의 공인 IP와 포트 넘버 (STUN, TURN 서버로부터 획득 가능)
  3. TURN 서버의 IP와 포트 넘버 (TURN 서버로부터 획득 가능)



#### ICE

> Interactive Connectivity Establishment

- 두 개의 단말이 P2P 연결을 가능하게 하도록 최적의 경로를 찾아주는 프레임워크
- ICE 를 통해서 두 브라우저가 P2P 통신을 할 수 있는 주소를 알아낼 수 있다.
  - 이까지하면 미디어와 관련된 정보를 교환하는 것만 남은 것이다.



### SDP

> Session Description Protocol

- WebRTC 에서 스트리밍 미디어의 해상도나 형식, 코덱 등의 멀티미디어 컨텐츠의 초기 인수를 설명하기 위해서 채택한 프로토콜
- 발행 구독 모델(Pub/Sub) 과 유사한 제안 응답 모델(Offer / Answer)을 가지고 있다.
  1. 어떤 피어가 특정한 미디어 스트림을 교환할 것이라고 제안한다.
     상대방으로부터 응답이 오기를 기다린다.
  2. 응답을 받으면 각 피어가 수집한 ICE 후보 중에서 최적의 경로를 결정하고 협상하는 프로세스 발생
     - 가장 빠르고 안정적인 경로를 찾는다.
     - 후보가 선택되면 기본적으로 필요한 모든 메타 데이터와 IP 주소 및 포트, 미디어 정보에 대한 피어간 합의가 완료된다.
  3. 피어간의 P2P 연결이 설정되고 활성화된다.
     - 로컬 데이터 스트림의 엔드포인트 생성



### Trickle ICE

- 후보를 찾아내는 과정이 동기적 프로세스라면 하나 찾고 난 다음에 하나 찾는 비효율적인 프로세스를 가지게 된다.
  - 이것을 해결하기 위해서!
    비효율적인 후보 교환 작업를 병렬 프로세스로 수행할 수 있게 만드는 것이 Trickle ICE



### 시그널링

> Signalling

- P2P 정차로서 STUN 서버, Candidate, ICE 등을 거치는 것을 시그널링이라고 한다.
- **RTCPeerConnection 통신에 사용할 프로토콜, 채널, 미디어 코덱 및 형식, 데이터 전송 방법, 라우팅 정보, NAT 통과 방법을 포함한 통신 규격을 교환하기 위해서 두 장치의 제어 정보를 교환하는 과정**
- WebRTC 자체에서 지원하는 기능이 아니라서 최적의 방법을 찾아서 사용한다.
- 적용기술
  - 웹소켓 (WebSocket)
  - 서버 전송 이벤트 (Server-sent-Event)





## Topology

> 연결유형

- Peer to Peer 토폴로지는 WebRTC 에서 다루는 유일한 연결 유형이지만, 다자간의 연결에는 좋지않다.
  - 서버 기반 토폴로지를 통해서 이러한 단점을 해결할 수 있다.



### Peer to Peer (Mesh)

- 서버를 사용하지 않고 참가자에게 직접 연결한다.
- 소규모에 적합
- 녹화 같은 서버가 필요한 기능을 사용할 수 없다.



### Selective Forwarding (SFU)

- 각 참가자는 암호화된 스트림을 서버에 업로드한 후 서버가 스트림을 다른 참가자에게 전달
- 업로드 효율은 좋지만 참가자가 많아질 수록 다운로드 스트림에 의해 클라이언트 리소스가 부족해질 수도 있다.



### Multipoint Control (Mixing)

- 각 참가자로부터 미디어를 수신하고 이것을 단일 스트림으로 믹싱한 다음 각 참가자에게 전송한다.
- 단일 스트림으로 믹싱 처리하는 서버와 CPU 가 필요하다.
- 클라이언트는 상대적으로 컴퓨터 스펙이 덜 필요하다.



### Hyper Topology

- 규모에 맞게 혼합해서 사용할 수 있다.







https://webrtchacks.com/kurento/
